{"version":3,"file":"module-types.min.js","sources":["../../src/extras/module-types.js"],"sourcesContent":["/*\n * Loads JSON, CSS, Wasm module types based on file extensions\n * Supports application/javascript falling back to JS eval\n */\n(function(global) {\n  const systemJSPrototype = global.System.constructor.prototype;\n  const instantiate = systemJSPrototype.instantiate;\n\n  const moduleTypesRegEx = /\\.(css|html|json|wasm)$/;\n  systemJSPrototype.shouldFetch = function (url) {\n    const path = url.split('?')[0].split('#')[0];\n    const ext = path.slice(path.lastIndexOf('.'));\n    return ext.match(moduleTypesRegEx);\n  }\n  systemJSPrototype.fetch = function (url) {\n    return fetch(url);\n  };\n\n  systemJSPrototype.instantiate = function (url, parent) {\n    const loader = this;\n    if (this.shouldFetch(url)) {\n      return this.fetch(url)\n      .then(function (res) {\n        if (!res.ok)\n          throw Error(res.status + ' ' + res.statusText + ', loading ' + url + (parent ? ' from ' + parent : ''));\n        const contentType = res.headers.get('content-type');\n        if (contentType.match(/^(text|application)\\/(x-)?javascript(;|$)/)) {\n          return res.text().then(function (source) {\n            (0, eval)(source);\n            return loader.getRegister();\n          });\n        }\n        else if (contentType.match(/^application\\/json(;|$)/)) {\n          return res.text().then(function (source) {\n            return [[], function (_export) {\n              return {\n                execute: function () {\n                  _export('default', JSON.parse(source));\n                }\n              };\n            }];\n          });\n        }\n        else if (contentType.match(/^text\\/css(;|$)/)) {\n          return res.text().then(function (source) {\n            return [[], function (_export) {\n              return {\n                execute: function () {\n                  // Relies on a Constructable Stylesheet polyfill\n                  const stylesheet = new CSSStyleSheet();\n                  stylesheet.replaceSync(source);\n                  _export('default', stylesheet);\n                }\n              };\n            }];\n          }); \n        }\n        else if (contentType.match(/^application\\/wasm(;|$)/)) {\n          return (WebAssembly.compileStreaming ? WebAssembly.compileStreaming(res) : res.arrayBuffer().then(WebAssembly.compile))\n          .then(function (module) {\n            const deps = [];\n            const setters = [];\n            const importObj = {};\n        \n            // we can only set imports if supported (eg early Safari doesnt support)\n            if (WebAssembly.Module.imports)\n              WebAssembly.Module.imports(module).forEach(function (impt) {\n                const key = impt.module;\n                if (deps.indexOf(key) === -1) {\n                  deps.push(key);\n                  setters.push(function (m) {\n                    importObj[key] = m;\n                  });\n                }\n              });\n        \n            return [deps, function (_export) {\n              return {\n                setters: setters,\n                execute: function () {\n                  return WebAssembly.instantiate(module, importObj)\n                  .then(function (instance) {\n                    _export(instance.exports);\n                  });\n                }\n              };\n            }];\n          });\n        }\n        else {\n          throw new Error('Unknown module type \"' + contentType + '\"');\n        }\n      });\n    }\n    return instantiate.apply(this, arguments);\n  };\n})(typeof self !== 'undefined' ? self : global);\n"],"names":[],"mappings":"yBAAA;;;;AAIA,CAAC,SAAS,MAAM,EAAE;EAChB,MAAM,iBAAiB,GAAG,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC;EAC9D,MAAM,WAAW,GAAG,iBAAiB,CAAC,WAAW,CAAC;;EAElD,MAAM,gBAAgB,GAAG,yBAAyB,CAAC;EACnD,iBAAiB,CAAC,WAAW,GAAG,UAAU,GAAG,EAAE;IAC7C,MAAM,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IAC7C,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;IAC9C,OAAO,GAAG,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;IACpC;EACD,iBAAiB,CAAC,KAAK,GAAG,UAAU,GAAG,EAAE;IACvC,OAAO,KAAK,CAAC,GAAG,CAAC,CAAC;GACnB,CAAC;;EAEF,iBAAiB,CAAC,WAAW,GAAG,UAAU,GAAG,EAAE,MAAM,EAAE;IACrD,MAAM,MAAM,GAAG,IAAI,CAAC;IACpB,IAAI,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE;MACzB,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC;OACrB,IAAI,CAAC,UAAU,GAAG,EAAE;QACnB,IAAI,CAAC,GAAG,CAAC,EAAE;UACT,MAAM,KAAK,CAAC,GAAG,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,UAAU,GAAG,YAAY,GAAG,GAAG,IAAI,MAAM,GAAG,QAAQ,GAAG,MAAM,GAAG,EAAE,CAAC,CAAC,CAAC;QAC1G,MAAM,WAAW,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QACpD,IAAI,WAAW,CAAC,KAAK,CAAC,2CAA2C,CAAC,EAAE;UAClE,OAAO,GAAG,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,UAAU,MAAM,EAAE;YACvC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC;YAClB,OAAO,MAAM,CAAC,WAAW,EAAE,CAAC;WAC7B,CAAC,CAAC;SACJ;aACI,IAAI,WAAW,CAAC,KAAK,CAAC,yBAAyB,CAAC,EAAE;UACrD,OAAO,GAAG,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,UAAU,MAAM,EAAE;YACvC,OAAO,CAAC,EAAE,EAAE,UAAU,OAAO,EAAE;cAC7B,OAAO;gBACL,OAAO,EAAE,YAAY;kBACnB,OAAO,CAAC,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;iBACxC;eACF,CAAC;aACH,CAAC,CAAC;WACJ,CAAC,CAAC;SACJ;aACI,IAAI,WAAW,CAAC,KAAK,CAAC,iBAAiB,CAAC,EAAE;UAC7C,OAAO,GAAG,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,UAAU,MAAM,EAAE;YACvC,OAAO,CAAC,EAAE,EAAE,UAAU,OAAO,EAAE;cAC7B,OAAO;gBACL,OAAO,EAAE,YAAY;;kBAEnB,MAAM,UAAU,GAAG,IAAI,aAAa,EAAE,CAAC;kBACvC,UAAU,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;kBAC/B,OAAO,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;iBAChC;eACF,CAAC;aACH,CAAC,CAAC;WACJ,CAAC,CAAC;SACJ;aACI,IAAI,WAAW,CAAC,KAAK,CAAC,yBAAyB,CAAC,EAAE;UACrD,OAAO,CAAC,WAAW,CAAC,gBAAgB,GAAG,WAAW,CAAC,gBAAgB,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;WACrH,IAAI,CAAC,UAAU,MAAM,EAAE;YACtB,MAAM,IAAI,GAAG,EAAE,CAAC;YAChB,MAAM,OAAO,GAAG,EAAE,CAAC;YACnB,MAAM,SAAS,GAAG,EAAE,CAAC;;;YAGrB,IAAI,WAAW,CAAC,MAAM,CAAC,OAAO;cAC5B,WAAW,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,UAAU,IAAI,EAAE;gBACzD,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC;gBACxB,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE;kBAC5B,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;kBACf,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE;oBACxB,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;mBACpB,CAAC,CAAC;iBACJ;eACF,CAAC,CAAC;;YAEL,OAAO,CAAC,IAAI,EAAE,UAAU,OAAO,EAAE;cAC/B,OAAO;gBACL,OAAO,EAAE,OAAO;gBAChB,OAAO,EAAE,YAAY;kBACnB,OAAO,WAAW,CAAC,WAAW,CAAC,MAAM,EAAE,SAAS,CAAC;mBAChD,IAAI,CAAC,UAAU,QAAQ,EAAE;oBACxB,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;mBAC3B,CAAC,CAAC;iBACJ;eACF,CAAC;aACH,CAAC,CAAC;WACJ,CAAC,CAAC;SACJ;aACI;UACH,MAAM,IAAI,KAAK,CAAC,uBAAuB,GAAG,WAAW,GAAG,GAAG,CAAC,CAAC;SAC9D;OACF,CAAC,CAAC;KACJ;IACD,OAAO,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;GAC3C,CAAC;CACH,EAAE,OAAO,IAAI,KAAK,WAAW,GAAG,IAAI,GAAG,MAAM,CAAC,CAAC"}